<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="Bookmark" href="favicon.ico">
    <link rel="Shortcut Icon" href="favicon.ico" />
    <!--[if lt IE 9]>
<script type="text/javascript" src="__STATIC__/admin/lib/html5.js"></script>
<script type="text/javascript" src="__STATIC__/admin/lib/respond.min.js"></script>
<![endif]-->
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/static/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/static/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/lib/Hui-iconfont/1.0.8/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/static/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/static/h-ui.admin/css/style.css" />
    <!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script><![endif]-->
    <!--/meta 作为公共模版分离出去-->

    <!-- fileinput -->
    <link rel="stylesheet" href="__STATIC__/admin/lib/bootstrap/css/bootstrap.min.css">
    <link href="__STATIC__/admin/lib/fileinput/css/fileinput.css" media="all" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="__STATIC__/admin/lib/fontawesome/css/all.css">
    <link href="__STATIC__/admin/lib/fileinput/themes/explorer-fas/theme.css" media="all" rel="stylesheet"
        type="text/css" />
    <!-- end -->

    <style type="text/css">
        .input-group.file-caption-main .btn {
            height: auto;
        }

        .krajee-default .file-thumb-progress .progress,
        .kv-upload-progress .progress {
            width: auto;
        }

        #kvFileinputModal.show {
            opacity: 1;
        }

        .kv-fileinput-error.file-error-message pre {
            background-color: inherit;
            border: none;
        }
    </style>
</head>

<body>
    <div class="page-container">
        <form action="" method="post" class="form form-horizontal" id="form-product-edit">
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品名称：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" class="input-text" value="{$goods.goodsname}" placeholder="" id=""
                        name="goodsname">
                </div>
                <input type="hidden" value="{$goods.id}" name="id" />
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>分类栏目：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <span class="select-box">
                        <select name="ids" class="select">
                            {volist name="category" id="vo"}
                            <option value="{$vo.id}|{$vo.pid}" {eq name="$vo.id" value="$goods.tid"
                                }selected{/eq}>{$vo.name} </option> {/volist} </select> </span> </div> </div> <div
                                class="row cl">
                                <label class="form-label col-xs-4 col-sm-2">商品单位：</label>
                                <div class="formControls col-xs-8 col-sm-9">
                                    <span class="select-box">
                                        <select class="select" name="unit">
                                            <option>请选择</option>
                                            <option value="1" {eq name="$goods.unit" value="1" }selected{/eq}>件
                                                </option> <option value="2" {eq name="$goods.unit" value="2"
                                                }selected{/eq}>斤 </option> <option value="3" {eq name="$goods.unit"
                                                value="3" }selected{/eq}>KG </option> <option value="4" {eq
                                                name="$goods.unit" value="4" }selected{/eq}>吨 </option> <option
                                                value="5" {eq name="$goods.unit" value="5" }selected{/eq}>套 </option>
                                                </select> </span> </div> </div> <div class="row cl">
                                                <label class="form-label col-xs-4 col-sm-2">商品属性：</label>
                                                <div class="formControls col-xs-8 col-sm-9 skin-minimal">
                                                    <div class="radio-box">
                                                        <input type="radio" name="attributes" value="0" {eq
                                                            name="$goods.attributes" value="0" }checked{/eq}>
                                                            <label>推荐</label>
                                                    </div>
                                                    <div class="radio-box">
                                                        <input type="radio" name="attributes" value="1" {eq
                                                            name="$goods.attributes" value="1" }checked{/eq}>
                                                            <label>上新</label>
                                                    </div>
                                                    <div class="radio-box">
                                                        <input type="radio" name="attributes" value="2" {eq
                                                            name="$goods.attributes" value="2" }checked{/eq}>
                                                            <label>热卖</label>
                                                    </div>
                                                    <div class="radio-box">
                                                        <input type="radio" name="attributes" value="3" {eq
                                                            name="$goods.attributes" value="3" }checked{/eq}>
                                                            <label>促销</label>
                                                    </div>
                                                    <div class="radio-box">
                                                        <input type="radio" name="attributes" value="4" {eq
                                                            name="$goods.attributes" value="4" }checked{/eq}>
                                                            <label>包邮</label>
                                                    </div>
                                                    <div class="radio-box">
                                                        <input type="radio" name="attributes" value="5" {eq
                                                            name="$goods.attributes" value="5" }checked{/eq}>
                                                            <label>限时卖</label>
                                                    </div>
                                                    <div class="radio-box">
                                                        <input type="radio" name="attributes" value="6" {eq
                                                            name="$goods.attributes" value="6" }checked{/eq}>
                                                            <label>不参与会员折扣</label>
                                                    </div>
                                                </div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">商品编号：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" class="input-text" value="{$goods.number}" placeholder=""
                                            id="" name="number">
                                    </div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">条形码：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" class="input-text" value="{$goods.barcode}" placeholder=""
                                            id="" name="barcode">
                                    </div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">现价：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" name="curprice" id="" placeholder=""
                                            value="{$goods.curprice}" class="input-text" style="width:90%">
                                        元</div>
                                </div>

                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">市场价格：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" name="oriprice" id="" placeholder=""
                                            value="{$goods.oriprice}" class="input-text" style="width:90%">
                                        元</div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">成本价格：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" name="cosprice" id="" placeholder=""
                                            value="{$goods.cosprice}" class="input-text" style="width:90%">
                                        元</div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">库存量：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" name="inventory" id="" placeholder=""
                                            value="{$goods.inventory}" class="input-text" style="width:90%">
                                    </div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">限制购买量：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" name="restrict" id="" placeholder=""
                                            value="{$goods.restrict}" class="input-text" style="width:90%">
                                    </div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">已经购买量：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" name="already" id="" placeholder="" value="{$goods.already}"
                                            class="input-text" style="width:90%">
                                    </div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">运费：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" name="freight" id="" placeholder="" value="{$goods.freight}"
                                            class="input-text" style="width:90%">
                                        元</div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">商品属性：</label>
                                    <div class="formControls col-xs-8 col-sm-9 skin-minimal">
                                        <div class="radio-box">
                                            <input type="radio" name="status" value="0" {eq name="$goods.status"
                                                value="0" }checked{/eq}> <label>上架</label>
                                        </div>
                                        <div class="radio-box">
                                            <input type="radio" name="status" value="1" {eq name="$goods.status"
                                                value="1" }checked{/eq}> <label>下架</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">商品排序：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input type="text" name="reoorder" id="" placeholder="" value="{$goods.reorder}"
                                            class="input-text">
                                    </div>
                                </div>
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">图片上传：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <input id="file-upload" name="file" type="file" multiple>
                                    </div>
                                </div>
                                <input type="hidden" id="imagepath" name="imagepath" value="{$goods.imagepath}" />
                                <div class="row cl">
                                    <label class="form-label col-xs-4 col-sm-2">详细内容：</label>
                                    <div class="formControls col-xs-8 col-sm-9">
                                        <script id="editor" type="text/plain"
                                            style="width:100%;height:400px;">{$goods.text}</script>
                                    </div>
                                </div>
                                <div class="row cl">
                                    <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
                                        <button class="btn btn-primary radius" type="submit">
                                            <i class="Hui-iconfont">&#xe632;</i>
                                            提交
                                        </button>
                                        <button onClick="layer_close();" class="btn btn-default radius"
                                            type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
                                    </div>
                                </div>
        </form>
    </div>

    <!--_footer 作为公共模版分离出去-->
    <script type="text/javascript" src="__STATIC__/admin/lib/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="__STATIC__/admin/lib/layer/2.4/layer.js"></script>
    <script type="text/javascript" src="__STATIC__/admin/static/h-ui/js/H-ui.js"></script>
    <script type="text/javascript" src="__STATIC__/admin/static/h-ui.admin/js/H-ui.admin.page.js"></script>
    <!--/_footer /作为公共模版分离出去-->

    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript" src="__STATIC__/admin/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
    <script type="text/javascript" src="__STATIC__/admin/lib/jquery.validation/1.14.0/validate-methods.js"></script>
    <script type="text/javascript" src="__STATIC__/admin/lib/jquery.validation/1.14.0/messages_zh.js"></script>
    <script type="text/javascript" src="__STATIC__/admin/lib/ueditor/1.4.3/ueditor.config.js"></script>
    <script type="text/javascript" src="__STATIC__/admin/lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
    <script type="text/javascript" src="__STATIC__/admin/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>

    <!-- fileinput js -->
    <script src="__STATIC__/admin/lib/bootstrap/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="__STATIC__/admin/lib/fileinput/js/plugins/piexif.js" type="text/javascript"></script>
    <script src="__STATIC__/admin/lib/fileinput/js/plugins/sortable.js" type="text/javascript"></script>
    <script src="__STATIC__/admin/lib/fileinput/js/fileinput.js" type="text/javascript"></script>
    <script src="__STATIC__/admin/lib/fileinput/js/locales/zh.js" type="text/javascript"></script>
    <script src="__STATIC__/admin/lib/fileinput/themes/fas/theme.js" type="text/javascript"></script>
    <!-- end -->
    <script type="text/javascript">
        $(function () {
            $('.skin-minimal input').iCheck({
                checkboxClass: 'icheckbox-blue',
                radioClass: 'iradio-blue',
                increaseArea: '20%'
            });
        });

        (function ($) {
            $("#file-upload").fileinput({
                theme: 'fas',
                language: 'zh',
                uploadUrl: "{:url('product/addFile')}",
                initialPreview: getiInitialPreview(),
                initialPreviewAsData: true,      // 确定传入预览数据，而不是原生标记语言
            }).on('fileuploaded', function (event, data, previewId, index) {
                let imagepath = $("#imagepath").val();

                let value;
                if (imagepath.length > 0) {
                    value = imagepath + ',' + index + '|' + data.response.path;
                } else {
                    value = index + '|' + data.response.path;
                }
                $("#imagepath").attr('value', value);
            });

            function getiInitialPreview(){
                let value = "{$goods.imagepath}";
                let paths = value.split(',');
                let pathMap = [];
                for(let i=0;i<paths.length;i++){
                    let pathArr = paths[i].split('|');
                    let path = pathArr[1];
                    pathMap[i] = "__STATIC__"+'/../uploads/'+path;
                }
                console.log(pathMap);
                return pathMap;
            }
            


        })(jQuery);

        $(function () {
            var ue = UE.getEditor('editor');
        });
        $(function () {
            $("#form-product-edit").validate({
                rules: {
                    number: {
                        number: true,
                    },
                    curprice: {
                        min: 0
                    },
                    oriprice: {
                        min: 0
                    },
                    cosprice: {
                        min: 0
                    },
                    freight: {
                        min: 0
                    }
                },
                onkeyup: false,
                focusCleanup: true,
                success: "valid",
                submitHandler: function (form) {
                    $(form).ajaxSubmit({
                        type: 'post', // 提交方式 get/post
                        url: "{:url('product/productEdit')}", // 需要提交的 url
                        dataType: 'json',
                        success: function (data) {
                            // data 保存提交后返回的数据，一般为 json 数据
                            // 此处可对 data 作相关处理
                            layer.alert(data.message, function (index) {
                                var index = parent.layer.getFrameIndex(window.name);
                                // parent.$('#btn-refresh').click();
                                parent.location.reload();
                                parent.layer.close(index);
                            });

                        },
                        error: function () {
                            layer.alert('提交失败！', function (index) {
                                var index = parent.layer.getFrameIndex(window.name);
                                parent.$('#btn-refresh').click();
                                parent.layer.close(index);
                            })

                        }
                    });

                }
            })
        });
    </script>
</body>

</html>